!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.CKEditor5=t():(e.CKEditor5=e.CKEditor5||{},e.CKEditor5.editorAdvancedLink=t())}(self,(()=>(()=>{var e={"ckeditor5/src/core.js":(e,t,i)=>{e.exports=i("dll-reference CKEditor5.dll")("./src/core.js")},"ckeditor5/src/typing.js":(e,t,i)=>{e.exports=i("dll-reference CKEditor5.dll")("./src/typing.js")},"ckeditor5/src/ui.js":(e,t,i)=>{e.exports=i("dll-reference CKEditor5.dll")("./src/ui.js")},"dll-reference CKEditor5.dll":e=>{"use strict";e.exports=CKEditor5.dll}},t={};function i(r){var o=t[r];if(void 0!==o)return o.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,i),n.exports}i.d=(e,t)=>{for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var r={};return(()=>{"use strict";i.d(r,{default:()=>d});var e=i("ckeditor5/src/core.js"),t=i("ckeditor5/src/typing.js");const o={linkTitle:{label:Drupal.t("Title"),viewAttribute:"title"},linkAriaLabel:{label:Drupal.t("ARIA label"),viewAttribute:"aria-label"},linkClass:{label:Drupal.t("CSS classes"),viewAttribute:"class"},linkId:{label:Drupal.t("ID"),viewAttribute:"id"},linkRel:{label:Drupal.t("Link relationship"),viewAttribute:"rel"}};class n extends e.Plugin{static get pluginName(){return"EditorAdvancedLinkEditing"}init(){const e=this.editor.config.get("editorAdvancedLink");if(!e.options)return void(this.enabledModelNames=[]);const t=Object.values(e.options);this.enabledModelNames=Object.keys(o).filter((e=>t.includes(o[e].viewAttribute))),this.enabledModelNames.forEach((e=>{this._allowAndConvertExtraAttribute(e,o[e].viewAttribute),this._removeExtraAttributeOnUnlinkCommandExecute(e),this._refreshExtraAttributeValue(e)})),this._addExtraAttributeOnLinkCommandExecute(Object.keys(o))}_allowAndConvertExtraAttribute(e,t){const i=this.editor;i.model.schema.extend("$text",{allowAttributes:e}),i.conversion.for("downcast").attributeToElement({model:e,view:(e,{writer:i})=>{const r=i.createAttributeElement("a",{[t]:e},{priority:5});return i.setCustomProperty("link",!0,r),r}}),i.conversion.for("upcast").elementToAttribute({view:{name:"a",attributes:{[t]:!0}},model:{key:e,value:e=>e.getAttribute(t)}})}_addExtraAttributeOnLinkCommandExecute(e){const t=this.editor,i=t.commands.get("link");let r=!1;i.on("execute",((i,o)=>{if(o.length<3)return;if(r)return void(r=!1);i.stop(),r=!0;const n=o[o.length-1],l=this.editor.model,s=l.document.selection;l.change((i=>{t.execute("link",...o);const r=s.getFirstPosition();e.forEach((e=>{if(s.isCollapsed){const t=r.textNode||r.nodeBefore;n[e]?i.setAttribute(e,n[e],i.createRangeOn(t)):i.removeAttribute(e,i.createRangeOn(t)),i.removeSelectionAttribute(e)}else{const t=l.schema.getValidRanges(s.getRanges(),e);for(const r of t)n[e]?i.setAttribute(e,n[e],r):i.removeAttribute(e,r)}}))}))}),{priority:"high"})}_removeExtraAttributeOnUnlinkCommandExecute(e){const i=this.editor,r=i.commands.get("unlink"),o=this.editor.model,n=o.document.selection;let l=!1;r.on("execute",(r=>{l||(r.stop(),o.change((()=>{l=!0,i.execute("unlink"),l=!1,o.change((i=>{let r;r=n.isCollapsed?[(0,t.findAttributeRange)(n.getFirstPosition(),e,n.getAttribute(e),o)]:o.schema.getValidRanges(n.getRanges(),e);for(const t of r)i.removeAttribute(e,t)}))})))}),{priority:"high"})}_refreshExtraAttributeValue(e){const t=this.editor.commands.get("link"),i=this.editor.model,r=i.document.selection;t.set(e,null),i.document.on("change",(()=>{t[e]=r.getAttribute(e)}))}}var l=i("ckeditor5/src/ui.js");class s extends e.Plugin{init(){const e=this.editor.plugins.get("EditorAdvancedLinkEditing").enabledModelNames;this._changeFormToVertical(),e.reverse().forEach((e=>{this._createExtraFormField(e,o[e]),this._handleDataLoadingIntoExtraFormField(e)})),this._handleExtraFormFieldSubmit(e)}_changeFormToVertical(){this.editor.plugins.get("LinkUI").formView.extendTemplate({attributes:{class:["ck-vertical-form","ck-link-form_layout-vertical"]}})}_createExtraFormField(e,t){const i=this.editor,r=i.locale,o=i.plugins.get("LinkUI").formView,n=new l.LabeledFieldView(r,l.createLabeledInputText);n.label=t.label,o.children.add(n,1),o.on("render",(()=>{o._focusables.add(n,1),o.focusTracker.add(n.element)})),o[e]=n}_handleExtraFormFieldSubmit(e){const t=this.editor,i=t.plugins.get("LinkUI").formView,r=t.commands.get("link");this.listenTo(i,"submit",(()=>{const t=e.reduce(((e,t)=>(e[t]=i[t].fieldView.element.value,e)),{});r.once("execute",((e,i)=>{if(i.length<3)i.push(t);else{if(3!==i.length)throw Error("The link command has more than 3 arguments.");Object.assign(i[2],t)}}),{priority:"highest"})}),{priority:"high"})}_handleDataLoadingIntoExtraFormField(e){const t=this.editor,i=t.commands.get("link"),r=t.plugins.get("LinkUI").formView;r[e].fieldView.bind("value").to(i,e),t.plugins.get("ContextualBalloon")._rotatorView.content.on("add",((t,o)=>{o===r&&(r[e].fieldView.element.value=i[e]||"")}))}}class a extends e.Plugin{static get requires(){return[n,s]}static get pluginName(){return"EditorAdvancedLink"}}const d={EditorAdvancedLink:a}})(),r=r.default})()));